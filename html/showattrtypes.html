<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>SaC Attribute Types</title>
        <meta name="description" content="An HTML representation of the attribute types used in AST of SaC">

        <!-- Define a viewport to mobile devices to use - telling the browser to assume that the page is
             as wide as the device (width=device-width) and setting the initial page zoom level to be 1
             (initial-scale=1.0) -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href='http://fonts.googleapis.com/css?family=PT+Serif' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="./css/style.css" />
        <link rel="stylesheet" type="text/css" href="./css/sac-ast.css">
        <style>
            #main {
                position: fixed;
                top: 100px;
                bottom: 0;
                width: 100%;
                overflow: auto;
                border-bottom: 1px #888 dotted;
            }

            #attrtype-table {
                max-width: 800px;
                margin: auto;
                margin-top: 15px;
                border-collapse: collapse;
            }

            #json-out {
                max-width: 700px;
                margin: auto;
                background: #efefef;
                font-size: 50%;
            }

            #button-row {
                max-width: 300px;
                margin: auto;
                margin-top: 15px;
                margin-bottom: 15px;
                text-align: center;
            }

            td, th {
                padding: .5em;
            }

            th {
                text-align: left;
                padding-bottom: 15px;
                /*background:#ccc;*/
                /*border-bottom: 2px solid #ccc;*/
            }

            tr:nth-child(even) td {
                background:#eee;
            }

            .cntr {
                text-align: center;
            }
            
            .button {
                text-align: center;
                cursor: pointer;
                color: #963;
                display: inline;
            }

            td.ctype {
                font-family: monospace;
            }
        </style>
        <script src="./js/jquery-1.11.2.js"></script>
        <script src="./js/jstree.js"></script>
        <script src="./ast.js"></script>
        <script>
        </script>
    </head>
    <body>
        <div id="header">

            <div id="menu">
                <ul>
                    <li><a href="showtree.html">SaC AST</a></li>
                    <li class="selected"><a href="showattrtypes.html">SaC Attribute Types</a></li>
                    <li><a href="showtraversals.html">SaC Traversals</a></li>
                    <li><a href="shownodesets.html">SaC Nodesets</a></li>
                </ul>
            </div>
            <h1>SaC Attribute Types</h1>
        </div>
        <div id="main">
            <table id="attrtype-table">
            </table>
            <div id="button-row">
                <div id="btn-addrow" class="button" onclick="javascript:add_row();">Add Type</div>
                &nbsp;&nbsp;
                <div id="btn-get-json" class="button" onclick="javascript:get_json();">Get JSON</div>
            </div>
            <pre id="json-out" contenteditable="true" style="visibility:hidden"><pre>
        </div>

        <script>
            // FIXME(artem) we don't display VTYPE and PERSISTENT
            function gen_row (name, val) {
              return  "<tr>"
              +  "<td contenteditable='true'>" + name + "</td>"
              +  "<td class='ctype' contenteditable='true'>" + val['ctype'] + "</td>"
              +  "<td class='cntr' contenteditable='true'>" + val['init'] + "</td>"
              +  "<td contenteditable='true'>" + val['copy'] + "</td>"
              +  "<td class='cntr'><div class='button' onclick='del_row(this)'>&#x2717;</div></td>"
              +  "</tr>"
            }

            function del_row (el) {
                var name = $('td:first', $(el).closest ('tr')).text();
                var r = confirm ("Are you sure you want to delete " + name + "?" )
                if (r) {
                    $(el).closest ('tr').remove ();
                }
            }

            function add_row () {
                $("#attrtype-table").append (gen_row ("&lt;name&gt;", 
                                                      {"ctype":"&lt;ctype&gt;",
                                                       "init": "&lt;init&gt;",
                                                       "copy": "&lt;copy&gt;"}));
            }

            // FIXME(artem) we don't display VTYPE and PERSISTENT
            function gen_rows (obj) {
                var t = "<tr>"
                      + "<th>Name</th>"
                      + "<th>C type</th>"
                      + "<th class='cntr'>Initial value</th>"
                      + "<th>Copy</th>"
                      + "<th class='cntr'>Del</th>"
                      + "</tr>"

                $.each (obj, function (name, val) {
                    t += gen_row (name, val)
                });
                return t
            }

            function get_json() {
                names = [];
                $("#attrtype-table tr").each (function (i, n) {
                    if (i == 0)
                        return;
                    
                    var r = $(n);
                    var name = r.find('td:eq(0)').text();
                    names.push (name);

                    var o = {};
                    if (attrtypes_json.hasOwnProperty (name))
                        o = attrtypes_json[name];

                    o['ctype'] = r.find('td:eq(1)').text();
                    o['init'] = r.find('td:eq(2)').text();
                    o['copy'] = r.find('td:eq(3)').text();
                    attrtypes_json[name] = o;
                });

                // Get rid of the old keys that are not in the table
                // --- they might have been renamed or derleted.
                Object.keys (attrtypes_json).forEach (function(n) {
                    if (!names.includes (n)) {
                        delete attrtypes_json[n];
                    }
                });

                // FIXME Sort the object over the key.

                $("#json-out").html (JSON.stringify(attrtypes_json, undefined, 4));
                $("#json-out").css('visibility', 'visible');
            }

            $(document).ready (function () {
                $("#attrtype-table").html (gen_rows (attrtypes_json));
            });
        </script>
    </body>
</html>
